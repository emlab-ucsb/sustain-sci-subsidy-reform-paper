---
output:
  html_document: default

title: "Paper # 1 - Figures"
author: "Kat Millage"
date: "`r format(Sys.time(), '%B %d, %Y')`"
fontsize: 11pt
---

# Description

```{r setup, include=FALSE}
# Load packages
library(knitr) 
library(countrycode) # country name matching
library(sf)
library(rworldmap)
library(rmapshaper)
library(RColorBrewer)
library(cowplot)
library(tidyverse)

source(here::here("functions", "MapMaker.R"))

# Path to cleaned subsidies data file
subsidy_dat_sumaila_path <- here::here("data", "edited", "sumaila_et_al_2019_subsidies_tidy.csv")

# Path to binned effort data file
effort_dat_binned_path <- here::here("results", "02-vessel-list", "effort_1x1_good_fishing_vessels_2018_raw.csv")

# Path to upsides data file 
upsides_dat_path <- here::here("data", "edited", "costello_et_al_2016_upsides_tidy.csv")

# Chunk options
knitr::opts_chunk$set(echo = TRUE, message = F, warning = F, prompt = F, error = F)

# Version name
version <- "v1"

# Directories for the output files generated by this script
results_dir <- paste0(here::here("papers", "sustainability-science-subsidy-paper", "figures/"), version, "/")
if (dir.exists(results_dir) == F) {
  dir.create(results_dir, recursive = T)
}
```

```{r}
# Land shapefile
world_land <- st_as_sf(rworldmap::countriesLow) ## data(countriesLow) is from the rworldmap package

# FAO regions
fao_regions <- read_sf(here::here("data", "shapefiles", "fao"), layer = "World_Fao_Zones") %>%
  rename(fao_region = zone) %>%
  rmapshaper::ms_simplify(keep = 0.05)
```

# Version 1: Binned effort and median F/Fmsy by FAO region

```{r}
effort_binned_good_fishing_vessels_2018 <- read_csv(effort_dat_binned_path)
```

# Correct outdated flag codes and Identify EU and USA dependent vessels

Before allocating catches and subsidies across vessels, we need to identify vessels flagged to states that are overseas dependencies of the EU or USA. We assume that these vessels recieve subsidies from their sovereign states and therefore their fishing efforts should be included in the totals. 

```{r}
# Load country dependencies helper file
country_dependencies <- read_csv(here::here("data", "lookup-tables", "country_dependencies.csv"))

# Netherlands overseas territories
nld_territories <- country_dependencies$iso3[country_dependencies$is_overseas_territory & country_dependencies$sovereign_iso3 == "NLD"]

# France overseas territories
fra_territories <- country_dependencies$iso3[country_dependencies$is_overseas_territory & country_dependencies$sovereign_iso3 == "FRA"]

# Denmark overseas territories
dnk_territories <- country_dependencies$iso3[country_dependencies$is_overseas_territory & country_dependencies$sovereign_iso3 == "DNK"]

# British overseas territories
gbr_territories <- country_dependencies$iso3[country_dependencies$is_overseas_territory & country_dependencies$sovereign_iso3 == "GBR"]

# Norway overseas territories
nor_territories <- country_dependencies$iso3[country_dependencies$is_overseas_territory & country_dependencies$sovereign_iso3 == "NOR"]

# US overseas territories:  American Samoa, Guam, Northern Marianas Islands, Puerto Rico, US Virgin Islands
usa_territories <- country_dependencies$iso3[country_dependencies$is_overseas_territory & country_dependencies$sovereign_iso3 == "USA"]

# Australian overseas territories: Christmas Island
aus_territories <- country_dependencies$iso3[country_dependencies$is_overseas_territory & country_dependencies$sovereign_iso3 == "AUS"]
```

We apply these to our binned fishing effort

```{r}
effort_binned <- effort_binned_good_fishing_vessels_2018 %>%
  mutate(new_flag = case_when(flag %in% nld_territories ~ "NLD",
                              flag %in% fra_territories ~ "FRA",
                              flag %in% dnk_territories ~ "DNK",
                              flag %in% gbr_territories ~ "GBR",
                              flag %in% nor_territories ~ "NOR",
                              flag %in% usa_territories ~ "USA",
                              flag %in% aus_territories ~ "AUS",
                              flag == "COK" ~ "NZL", # for now assign cook islands to new zealand
                              TRUE ~ flag))

effort_binned$new_flag[effort_binned$new_flag == "GCA"] <- "GTM"
effort_binned$new_flag[effort_binned$new_flag == "ROM"] <- "ROU"
effort_binned$new_flag[effort_binned$new_flag == "UNK"] <- NA
```

### Subsidy intensities

Now lets get fishing effort totals by flag state

```{r}
effort_totals_flag <- effort_binned %>%
  group_by(new_flag) %>%
  summarize(fishing_KWh_lat_lon = sum(fishing_KWh_lat_lon, na.rm = T),
            fishing_hours_lat_lon = sum(fishing_hours_lat_lon, na.rm = T))
```

We then load our subsidy data, and calculate subsidy rates by flag for 2018. Subsidy rates are then applied to our binned effort data by flag. 

```{r}
subsidy_dat_sumaila <- read_csv(subsidy_dat_sumaila_path) %>%
  group_by(iso3, category, type) %>%
  summarize(value = sum(value, na.rm = T)) %>%
  group_by(iso3) %>%
  summarize(A_subs = sum(value[category == "A"], na.rm = T),
            B_subs = sum(value[category == "B"], na.rm = T),
            C_subs = sum(value[category == "C"], na.rm = T),
            BC_subs = sum(value[category %in% c("B", "C")], na.rm = T),
            tot_subs = sum(value, na.rm = T),
            fuel_subs = sum(value[type == "B7"], na.rm = T))
```

```{r}
# Calculate subsidy rates by flag
subsidy_rates_flag <- effort_totals_flag %>%
  left_join(subsidy_dat_sumaila, by = c("new_flag" = "iso3")) %>%
  mutate_at(vars(contains("subs")), list(KWh = ~./fishing_KWh_lat_lon)) %>%
  dplyr::select(new_flag, contains("subs_KWh"))

# Apply subsidy rates to binned effort
effort_binned_sub_intensity <- effort_binned %>%
  left_join(subsidy_rates_flag, by = "new_flag")

# Summarize by lat/lon
subsidy_intensity_binned <- effort_binned_sub_intensity %>%
  group_by(lat_bin_center, lon_bin_center) %>%
  summarize_at(vars(contains("subs_KWh"), "fishing_KWh_lat_lon"), 
               list(median = ~median(., na.rm = T),
                    mean = ~ mean(., na.rm = T),
                    w_mean = ~weighted.mean(., w = fishing_KWh_lat_lon, na.rm = T),
                    sum = ~sum(., na.rm = T))) %>%
  dplyr::select(-c(contains("subs_KWh_sum"), "fishing_KWh_lat_lon_median", "fishing_KWh_lat_lon_mean", "fishing_KWh_lat_lon_w_mean"))

# Summarize by fao region
subsidy_intensity_region <- effort_binned_sub_intensity %>%
  group_by(fao_region) %>%
  summarize_at(vars(contains("subs_KWh"), "fishing_KWh_lat_lon"), 
               list(median = ~median(., na.rm = T),
                    mean = ~ mean(., na.rm = T),
                    w_mean = ~weighted.mean(., w = fishing_KWh_lat_lon, na.rm = T),
                    sum = ~sum(., na.rm = T))) %>%
  dplyr::select(-c(contains("subs_KWh_sum"), "fishing_KWh_lat_lon_median", "fishing_KWh_lat_lon_mean", "fishing_KWh_lat_lon_w_mean"))
```

Now we go back to our effort data, and apply our subsidy rates. 

```{r}
subs_fill_label <- "Subsidy Intensity \n($/KWh)"
```

## Total Subsidies

### Subsidy Intensity by 1x1 Degree

```{r, fig.width=4, fig.height=7}
# Scales 
tot_subs_fill_breaks <- seq(0,8, by = 2)
tot_subs_fill_limits <- c(0,8)
tot_subs_fill_labels <- c("0", "2", "4", "6", "\u2265 8")

# Total subsidies (grid)
subsidy_intensity_tot_grid_l <- MapMaker(data = subsidy_intensity_binned,
                                         res = "grid",
                                         x = "lon_bin_center",
                                         y = "lat_bin_center",
                                         fill = "tot_subs_KWh",
                                         fill_name = subs_fill_label,
                                         fill_breaks = tot_subs_fill_breaks,
                                         fill_limits = tot_subs_fill_limits,
                                         fill_labels = tot_subs_fill_labels,
                                         land_sf = world_land,
                                         plot_labels = c("A) Median", "B) Mean", "C) Weighted Mean"),
                                         file_name = "subsidy_intensity_tot_grid_map",
                                         file_dir = results_dir,
                                         fill_palette = "seq")

subsidy_intensity_tot_grid_l[["all"]]

```
  
### Subsidy Intensities by Region

```{r, fig.width=4, fig.height=7}
# Total subsidies (region)
subsidy_intensity_tot_region_l <- MapMaker(data = subsidy_intensity_region,
                                         res = "region",
                                         x = "lon_bin_center",
                                         y = "lat_bin_center",
                                         fill = "tot_subs_KWh",
                                         fill_name = subs_fill_label,
                                         fill_breaks = tot_subs_fill_breaks,
                                         fill_limits = tot_subs_fill_limits,
                                         fill_labels = tot_subs_fill_labels,
                                         land_sf = world_land,
                                         region_sf = fao_regions,
                                         plot_labels = c("A) Median", "B) Mean", "C) Weighted Mean"),
                                         file_name = "subsidy_intensity_tot_region_map",
                                         file_dir = results_dir,
                                         fill_palette = "seq")

subsidy_intensity_tot_region_l[["all"]]
```

```{r, fig.width=8, fig.height=7}
# Combine into six panel
subsidy_intensity_tot_map <- plot_grid(
  
  plot_grid(subsidy_intensity_tot_grid_l[["median"]] + theme(legend.position = "none"),
            subsidy_intensity_tot_region_l[["median"]] + theme(legend.position = "none"),
            subsidy_intensity_tot_grid_l[["mean"]] + theme(legend.position = "none"),
            subsidy_intensity_tot_region_l[["mean"]] + theme(legend.position = "none"),
            subsidy_intensity_tot_grid_l[["w_mean"]] + theme(legend.position = "none"),
            subsidy_intensity_tot_region_l[["w_mean"]] + theme(legend.position = "none"),
            ncol = 2,
            labels = c("A) Median", "", "B) Mean", "", "C) Weighted Mean"),
            align = "hv"),

  get_legend(subsidy_intensity_tot_region_l[["w_mean"]]),
  rel_heights = c(2,0.2),
  ncol = 1)

subsidy_intensity_tot_map
ggsave(paste0(results_dir, "subsidy_intensity_tot_map.png"), dpi = 200, width = 14, height = 12.5)
```

## Bad Subsidies Only

### Subsidy Intensity by 1x1 Degree

```{r, fig.width=4, fig.height=7}
# Scales 
B_subs_fill_breaks <- seq(0,5, by = 1)
B_subs_fill_limits <- c(0,5)
B_subs_fill_labels <- c("0","1", "2", "3", "4", "\u2265 5")

# Total subsidies (grid)
subsidy_intensity_B_grid_l <- MapMaker(data = subsidy_intensity_binned,
                                         res = "grid",
                                         x = "lon_bin_center",
                                         y = "lat_bin_center",
                                         fill = "B_subs_KWh",
                                         fill_name = subs_fill_label,
                                         fill_breaks = B_subs_fill_breaks,
                                         fill_limits = B_subs_fill_limits,
                                         fill_labels = B_subs_fill_labels,
                                         land_sf = world_land,
                                         plot_labels = c("A) Median", "B) Mean", "C) Weighted Mean"),
                                         file_name = "subsidy_intensity_B_grid_map",
                                         file_dir = results_dir,
                                       fill_palette = "seq")

subsidy_intensity_B_grid_l[["all"]]

```

### Subsidy Intensities by Region

```{r, fig.width=4, fig.height=7}
# Total subsidies (region)
subsidy_intensity_B_region_l <- MapMaker(data = subsidy_intensity_region,
                                         res = "region",
                                         x = "lon_bin_center",
                                         y = "lat_bin_center",
                                         fill = "B_subs_KWh",
                                         fill_name = subs_fill_label,
                                         fill_breaks = B_subs_fill_breaks,
                                         fill_limits = B_subs_fill_limits,
                                         fill_labels = B_subs_fill_labels,
                                         land_sf = world_land,
                                         region_sf = fao_regions,
                                         plot_labels = c("A) Median", "B) Mean", "C) Weighted Mean"),
                                         file_name = "subsidy_intensity_B_region_map",
                                         file_dir = results_dir,
                                         fill_palette = "seq")

subsidy_intensity_B_region_l[["all"]]
```

```{r, fig.width=8, fig.height=7}
# Combine into six panel
subsidy_intensity_B_map <- plot_grid(
  
  plot_grid(subsidy_intensity_B_grid_l[["median"]] + theme(legend.position = "none"),
            subsidy_intensity_B_region_l[["median"]] + theme(legend.position = "none"),
            subsidy_intensity_B_grid_l[["mean"]] + theme(legend.position = "none"),
            subsidy_intensity_B_region_l[["mean"]] + theme(legend.position = "none"),
            subsidy_intensity_B_grid_l[["w_mean"]] + theme(legend.position = "none"),
            subsidy_intensity_B_region_l[["w_mean"]] + theme(legend.position = "none"),
            ncol = 2,
            labels = c("A) Median", "", "B) Mean", "", "C) Weighted Mean"),
            align = "hv"),

  get_legend(subsidy_intensity_B_region_l[["w_mean"]]),
  rel_heights = c(2,0.2),
  ncol = 1)

subsidy_intensity_B_map
ggsave(paste0(results_dir, "subsidy_intensity_B_map.png"), dpi = 200, width = 14, height = 12.5)
```

## Bad and Ambiguous Subsidies Only

### Subsidy Intensities by Lat/Lon

```{r, fig.width=4, fig.height=7}
# Scales 
BC_subs_fill_breaks <- seq(0,3, by = 0.75)
BC_subs_fill_limits <- c(0,3)
BC_subs_fill_labels <- c("0", "0.75", "1.5", "2.25", "\u2265 3")

# Total subsidies (grid)
subsidy_intensity_BC_grid_l <- MapMaker(data = subsidy_intensity_binned,
                                         res = "grid",
                                         x = "lon_bin_center",
                                         y = "lat_bin_center",
                                         fill = "BC_subs_KWh",
                                         fill_name = subs_fill_label,
                                         fill_breaks = BC_subs_fill_breaks,
                                         fill_limits = BC_subs_fill_limits,
                                         fill_labels = BC_subs_fill_labels,
                                         land_sf = world_land,
                                         plot_labels = c("A) Median", "B) Mean", "C) Weighted Mean"),
                                         file_name = "subsidy_intensity_BC_grid_map",
                                         file_dir = results_dir,
                                        fill_palette = "seq")

subsidy_intensity_BC_grid_l[["all"]]

```

### Subsidy Intensities by Region

```{r, fig.width=4, fig.height=7}
# Total subsidies (region)
subsidy_intensity_BC_region_l <- MapMaker(data = subsidy_intensity_region,
                                         res = "region",
                                         x = "lon_bin_center",
                                         y = "lat_bin_center",
                                         fill = "BC_subs_KWh",
                                         fill_name = subs_fill_label,
                                         fill_breaks = BC_subs_fill_breaks,
                                         fill_limits = BC_subs_fill_limits,
                                         fill_labels = BC_subs_fill_labels,
                                         land_sf = world_land,
                                         region_sf = fao_regions,
                                         plot_labels = c("A) Median", "B) Mean", "C) Weighted Mean"),
                                         file_name = "subsidy_intensity_BC_region_map",
                                         file_dir = results_dir,
                                         fill_palette = "seq")

subsidy_intensity_BC_region_l[["all"]]
```

```{r, fig.width=8, fig.height=7}
# Combine into six panel
subsidy_intensity_BC_map <- plot_grid(
  
  plot_grid(subsidy_intensity_BC_grid_l[["median"]] + theme(legend.position = "none"),
            subsidy_intensity_BC_region_l[["median"]] + theme(legend.position = "none"),
            subsidy_intensity_BC_grid_l[["mean"]] + theme(legend.position = "none"),
            subsidy_intensity_BC_region_l[["mean"]] + theme(legend.position = "none"),
            subsidy_intensity_BC_grid_l[["w_mean"]] + theme(legend.position = "none"),
            subsidy_intensity_BC_region_l[["w_mean"]] + theme(legend.position = "none"),
            ncol = 2,
            labels = c("A) Median", "", "B) Mean", "", "C) Weighted Mean"),
            align = "hv"),

  get_legend(subsidy_intensity_BC_region_l[["w_mean"]]),
  rel_heights = c(2,0.2),
  ncol = 1)

subsidy_intensity_BC_map
ggsave(paste0(results_dir, "subsidy_intensity_BC_map.png"), dpi = 200, width = 14, height = 12.5)
```

## Fuel Subsidies Only

### Subsidy Intensities by Lat/Lon

```{r, fig.width=4, fig.height=7}
# Scales 
fuel_subs_fill_breaks <- seq(0,2, by = 0.5)
fuel_subs_fill_limits <- c(0,2)
fuel_subs_fill_labels <- c("0", "0.5", "1", "1.5", "\u2265 2")

# Total subsidies (grid)
subsidy_intensity_fuel_grid_l <- MapMaker(data = subsidy_intensity_binned,
                                         res = "grid",
                                         x = "lon_bin_center",
                                         y = "lat_bin_center",
                                         fill = "fuel_subs_KWh",
                                         fill_name = subs_fill_label,
                                         fill_breaks = fuel_subs_fill_breaks,
                                         fill_limits = fuel_subs_fill_limits,
                                         fill_labels = fuel_subs_fill_labels,
                                         land_sf = world_land,
                                         plot_labels = c("A) Median", "B) Mean", "C) Weighted Mean"),
                                         file_name = "subsidy_intensity_fuel_grid_map",
                                         file_dir = results_dir)

subsidy_intensity_fuel_grid_l[["all"]]

```

### Subsidy Intensities by Region

```{r, fig.width=4, fig.height=7}
# Total subsidies (region)
subsidy_intensity_fuel_region_l <- MapMaker(data = subsidy_intensity_region,
                                         res = "region",
                                         x = "lon_bin_center",
                                         y = "lat_bin_center",
                                         fill = "fuel_subs_KWh",
                                         fill_name = subs_fill_label,
                                         fill_breaks = fuel_subs_fill_breaks,
                                         fill_limits = fuel_subs_fill_limits,
                                         fill_labels = fuel_subs_fill_labels,
                                         land_sf = world_land,
                                         region_sf = fao_regions,
                                         plot_labels = c("A) Median", "B) Mean", "C) Weighted Mean"),
                                         file_name = "subsidy_intensity_fuel_region_map",
                                         file_dir = results_dir)

subsidy_intensity_fuel_region_l[["all"]]
```

```{r, fig.width=8, fig.height=7}
# Combine into six panel
subsidy_intensity_fuel_map <- plot_grid(
  
  plot_grid(subsidy_intensity_fuel_grid_l[["median"]] + theme(legend.position = "none"),
            subsidy_intensity_fuel_region_l[["median"]] + theme(legend.position = "none"),
            subsidy_intensity_fuel_grid_l[["mean"]] + theme(legend.position = "none"),
            subsidy_intensity_fuel_region_l[["mean"]] + theme(legend.position = "none"),
            subsidy_intensity_fuel_grid_l[["w_mean"]] + theme(legend.position = "none"),
            subsidy_intensity_fuel_region_l[["w_mean"]] + theme(legend.position = "none"),
            ncol = 2,
            labels = c("A) Median", "", "B) Mean", "", "C) Weighted Mean"),
            align = "hv"),

  get_legend(subsidy_intensity_fuel_region_l[["w_mean"]]),
  rel_heights = c(2,0.2),
  ncol = 1)

subsidy_intensity_fuel_map
ggsave(paste0(results_dir, "subsidy_intensity_fuel_map.png"), dpi = 200, width = 14, height = 12.5)
```

## Stock status 

Now we load the upsides database, calculate mean and median F/Fmsy by FAO region, and plot. 

```{r}
upsides_dat <- read_csv(upsides_dat_path) 

upsides_region <- upsides_dat %>%
  group_by(region_fao_split) %>%
  summarize_at(vars("fv_fmsy", "bv_bmsy", "msy"), list(median = ~median(., na.rm = T),
                                                      mean = ~mean(., na.rm = T),
                                                      w_mean = ~weighted.mean(., w = msy, na.rm = T),
                                                      tot = ~sum(., na.rm = T))) %>%
  dplyr::select(-c("fv_fmsy_tot", "bv_bmsy_tot", "msy_median", "msy_mean", "msy_w_mean")) %>%
  rename(fao_region = region_fao_split)
```

### F/Fmsy by Region

```{r, fig.width=4, fig.height=7}
# Fmsy (region)
F_Fmsy_region_l <- MapMaker(data = upsides_region,
                            res = "region",
                            fill = "fv_fmsy",
                            fill_name = "F/Fmsy",
                            fill_breaks = seq(0,3, by = 0.75),
                            fill_limits = c(0, 3),
                            fill_labels = c("0", "0.75", "1.5", "2.25", "\u2265 3"),
                            land_sf = world_land,
                            region_sf = fao_regions,
                            plot_labels = c("A) Median", "B) Mean", "C) Weighted Mean"),
                            file_name = "F_Fmsy_region_map",
                            file_dir = results_dir,
                            fill_palette = "div",
                            fill_low = "#001f9e",
                            fill_high = "#EF3B2C",
                            fill_mid = "#ffffff",
                            fill_midpoint = 1)

F_Fmsy_region_l[["all"]]
```

### B/Bmsy by Region

```{r, fig.width=4, fig.height=7}
# B/Bmsy (region)
B_Bmsy_region_l <- MapMaker(data = upsides_region,
                            res = "region",
                            fill = "bv_bmsy",
                            fill_name = "B/Bmsy",
                            fill_breaks = seq(0,2, by = 0.5),
                            fill_limits = c(0, 2),
                            fill_labels = c("0", "0.5", "1", "1.5", "\u2265 2"),
                            land_sf = world_land,
                            region_sf = fao_regions,
                            plot_labels = c("A) Median", "B) Mean", "C) Weighted Mean"),
                            file_name = "B_Bmsy_region_map",
                            file_dir = results_dir,
                            fill_palette = "div",
                            fill_low = "#0031f7",
                            fill_high = "#EF3B2C",
                            fill_mid = "#ffffff",
                            fill_midpoint = 1)

B_Bmsy_region_l[["all"]]
```

## Coorelations Between Subsidy Intensity and Stock Status 

```{r}
subsidy_intensity_upsides_region <- upsides_region %>%
  left_join(subsidy_intensity_region, by = "fao_region")
```

```{r}
# Set some plot scales
subs_x <- c(0,4)
f_y <- c(0,3)
effort_fill_lim <- c(0,7.5e9)
effort_fill_breaks <- seq(0,7.5e9, length.out = 5)
effort_fill_labels <- format(seq(0,7.5e9, length.out = 5)/1e9, scientific = F, digits = 2)

f_label <- "F/Fmsy"
b_label <- "B/Bmsy"

effort_label <- "Total Fishing Effort \n(KWh, billions)"
```

### Weighted Mean Subsidies vs F/Fmsy

#### Total Subsidies

```{r}
w_mean_tot_subs_vs_F_Fmsy_l <- MapMaker(data = subsidy_intensity_upsides_region,
                                        res = "corr",
                                        x = "tot_subs_KWh_w_mean",
                                        x_name = paste0("Weighted Mean Subsidy Intensity ($/KWh)"),
                                        x_limits = subs_x,
                                        y = "fv_fmsy",
                                        y_name = f_label,
                                        y_limits = f_y,
                                        fill = "fishing_KWh_lat_lon_sum",
                                        fill_name = effort_label,
                                        fill_limits = effort_fill_lim,
                                        fill_breaks = effort_fill_breaks,
                                        fill_labels = effort_fill_labels,
                                        file_name = "w_mean_tot_subs_vs_F_Fmsy_plot",
                                        file_dir = results_dir)

w_mean_tot_subs_vs_F_Fmsy_l[["all"]]
```

#### Bad Subsidies Only

```{r}
w_mean_B_subs_vs_F_Fmsy_l <- MapMaker(data = subsidy_intensity_upsides_region,
                                        res = "corr",
                                        x = "B_subs_KWh_w_mean",
                                        x_name = paste0("Weighted Mean Subsidy Intensity ($/KWh)"),
                                        x_limits = subs_x,
                                        y = "fv_fmsy",
                                        y_name = f_label,
                                        y_limits = f_y,
                                        fill = "fishing_KWh_lat_lon_sum",
                                        fill_name = effort_label,
                                        fill_limits = effort_fill_lim,
                                        fill_breaks = effort_fill_breaks,
                                        fill_labels = effort_fill_labels,
                                        file_name = "w_mean_B_subs_vs_F_Fmsy_plot",
                                        file_dir = results_dir)

w_mean_B_subs_vs_F_Fmsy_l[["all"]]
```

#### Bad and Ambiguous Subsidies Only

```{r}
w_mean_BC_subs_vs_F_Fmsy_l <- MapMaker(data = subsidy_intensity_upsides_region,
                                        res = "corr",
                                        x = "BC_subs_KWh_w_mean",
                                        x_name = paste0("Weighted Mean Subsidy Intensity ($/KWh)"),
                                        x_limits = subs_x,
                                        y = "fv_fmsy",
                                        y_name = f_label,
                                        y_limits = f_y,
                                        fill = "fishing_KWh_lat_lon_sum",
                                        fill_name = effort_label,
                                        fill_limits = effort_fill_lim,
                                        fill_breaks = effort_fill_breaks,
                                        fill_labels = effort_fill_labels,
                                        file_name = "w_mean_BC_subs_vs_F_Fmsy_plot",
                                        file_dir = results_dir)

w_mean_BC_subs_vs_F_Fmsy_l[["all"]]
```

#### Fuel Subsidies Only

```{r}
w_mean_fuel_subs_vs_F_Fmsy_l <- MapMaker(data = subsidy_intensity_upsides_region,
                                        res = "corr",
                                        x = "fuel_subs_KWh_w_mean",
                                        x_name = paste0("Weighted Mean Subsidy Intensity ($/KWh)"),
                                        x_limits = c(0,1),
                                        y = "fv_fmsy",
                                        y_name = f_label,
                                        y_limits = f_y,
                                        fill = "fishing_KWh_lat_lon_sum",
                                        fill_name = effort_label,
                                        fill_limits = effort_fill_lim,
                                        fill_breaks = effort_fill_breaks,
                                        fill_labels = effort_fill_labels,
                                        file_name = "w_mean_fuel_subs_vs_F_Fmsy_plot",
                                        file_dir = results_dir)

w_mean_fuel_subs_vs_F_Fmsy_l[["all"]]
```

### Mean Subsidies vs F/Fmsy

#### Total Subsidies

```{r}
mean_tot_subs_vs_F_Fmsy_l <- MapMaker(data = subsidy_intensity_upsides_region,
                                        res = "corr",
                                        x = "tot_subs_KWh_mean",
                                        x_name = paste0("Mean Subsidy Intensity ($/KWh)"),
                                        x_limits = subs_x,
                                        y = "fv_fmsy",
                                        y_name = f_label,
                                        y_limits = f_y,
                                        fill = "fishing_KWh_lat_lon_sum",
                                        fill_name = effort_label,
                                        fill_limits = effort_fill_lim,
                                        fill_breaks = effort_fill_breaks,
                                        fill_labels = effort_fill_labels,
                                        file_name = "mean_tot_subs_vs_F_Fmsy_plot",
                                        file_dir = results_dir)

mean_tot_subs_vs_F_Fmsy_l[["all"]]
```

#### Bad Subsidies Only

```{r}
mean_B_subs_vs_F_Fmsy_l <- MapMaker(data = subsidy_intensity_upsides_region,
                                        res = "corr",
                                        x = "B_subs_KWh_mean",
                                        x_name = paste0("Mean Subsidy Intensity ($/KWh)"),
                                        x_limits = subs_x,
                                        y = "fv_fmsy",
                                        y_name = f_label,
                                        y_limits = f_y,
                                        fill = "fishing_KWh_lat_lon_sum",
                                        fill_name = effort_label,
                                        fill_limits = effort_fill_lim,
                                        fill_breaks = effort_fill_breaks,
                                        fill_labels = effort_fill_labels,
                                        file_name = "mean_B_subs_vs_F_Fmsy_plot",
                                        file_dir = results_dir)

mean_B_subs_vs_F_Fmsy_l[["all"]]
```

#### Bad and Ambiguous Subsidies Only

```{r}
mean_BC_subs_vs_F_Fmsy_l <- MapMaker(data = subsidy_intensity_upsides_region,
                                        res = "corr",
                                        x = "BC_subs_KWh_mean",
                                        x_name = paste0("Mean Subsidy Intensity ($/KWh)"),
                                        x_limits = subs_x,
                                        y = "fv_fmsy",
                                        y_name = f_label,
                                        y_limits = f_y,
                                        fill = "fishing_KWh_lat_lon_sum",
                                        fill_name = effort_label,
                                        fill_limits = effort_fill_lim,
                                        fill_breaks = effort_fill_breaks,
                                        fill_labels = effort_fill_labels,
                                        file_name = "mean_BC_subs_vs_F_Fmsy_plot",
                                        file_dir = results_dir)

mean_BC_subs_vs_F_Fmsy_l[["all"]]
```

#### Fuel Subsidies Only

```{r}
mean_fuel_subs_vs_F_Fmsy_l <- MapMaker(data = subsidy_intensity_upsides_region,
                                        res = "corr",
                                        x = "fuel_subs_KWh_mean",
                                        x_name = paste0("Mean Subsidy Intensity ($/KWh)"),
                                        x_limits = subs_x,
                                        y = "fv_fmsy",
                                        y_name = f_label,
                                        y_limits = f_y,
                                        fill = "fishing_KWh_lat_lon_sum",
                                        fill_name = effort_label,
                                        fill_limits = effort_fill_lim,
                                        fill_breaks = effort_fill_breaks,
                                        fill_labels = effort_fill_labels,
                                        file_name = "mean_fuel_subs_vs_F_Fmsy_plot",
                                        file_dir = results_dir)

mean_fuel_subs_vs_F_Fmsy_l[["all"]]
```

### Median Subsidies vs F/Fmsy

#### Total Subsidies

```{r}
median_tot_subs_vs_F_Fmsy_l <- MapMaker(data = subsidy_intensity_upsides_region,
                                        res = "corr",
                                        x = "tot_subs_KWh_median",
                                        x_name = paste0("Median Subsidy Intensity ($/KWh)"),
                                        x_limits = subs_x,
                                        y = "fv_fmsy",
                                        y_name = f_label,
                                        y_limits = f_y,
                                        fill = "fishing_KWh_lat_lon_sum",
                                        fill_name = effort_label,
                                        fill_limits = effort_fill_lim,
                                        fill_breaks = effort_fill_breaks,
                                        fill_labels = effort_fill_labels,
                                        file_name = "median_tot_subs_vs_F_Fmsy_plot",
                                        file_dir = results_dir)

median_tot_subs_vs_F_Fmsy_l[["all"]]
```

#### Bad Subsidies Only

```{r}
median_B_subs_vs_F_Fmsy_l <- MapMaker(data = subsidy_intensity_upsides_region,
                                        res = "corr",
                                        x = "B_subs_KWh_median",
                                        x_name = paste0("Median Subsidy Intensity ($/KWh)"),
                                        x_limits = subs_x,
                                        y = "fv_fmsy",
                                        y_name = f_label,
                                        y_limits = f_y,
                                        fill = "fishing_KWh_lat_lon_sum",
                                        fill_name = effort_label,
                                        fill_limits = effort_fill_lim,
                                        fill_breaks = effort_fill_breaks,
                                        fill_labels = effort_fill_labels,
                                        file_name = "median_B_subs_vs_F_Fmsy_plot",
                                        file_dir = results_dir)

median_B_subs_vs_F_Fmsy_l[["all"]]
```

#### Bad and Ambiguous Subsidies Only

```{r}
median_BC_subs_vs_F_Fmsy_l <- MapMaker(data = subsidy_intensity_upsides_region,
                                        res = "corr",
                                        x = "BC_subs_KWh_median",
                                        x_name = paste0("Median Subsidy Intensity ($/KWh)"),
                                        x_limits = subs_x,
                                        y = "fv_fmsy",
                                        y_name = f_label,
                                        y_limits = f_y,
                                        fill = "fishing_KWh_lat_lon_sum",
                                        fill_name = effort_label,
                                        fill_limits = effort_fill_lim,
                                        fill_breaks = effort_fill_breaks,
                                        fill_labels = effort_fill_labels,
                                        file_name = "median_BC_subs_vs_F_Fmsy_plot",
                                        file_dir = results_dir)

median_BC_subs_vs_F_Fmsy_l[["all"]]
```

#### Fuel Subsidies Only

```{r}
median_fuel_subs_vs_F_Fmsy_l <- MapMaker(data = subsidy_intensity_upsides_region,
                                        res = "corr",
                                        x = "fuel_subs_KWh_median",
                                        x_name = paste0("Median Subsidy Intensity ($/KWh)"),
                                        x_limits = subs_x,
                                        y = "fv_fmsy",
                                        y_name = f_label,
                                        y_limits = f_y,
                                        fill = "fishing_KWh_lat_lon_sum",
                                        fill_name = effort_label,
                                        fill_limits = effort_fill_lim,
                                        fill_breaks = effort_fill_breaks,
                                        fill_labels = effort_fill_labels,
                                        file_name = "median_fuel_subs_vs_F_Fmsy_plot",
                                        file_dir = results_dir)

median_fuel_subs_vs_F_Fmsy_l[["all"]]
```

## Figure 1 (Using Bad Subisides)

```{r}
top_row <- plot_grid(

  plot_grid(subsidy_intensity_B_grid_l[["w_mean"]] + theme(legend.position = "none"),
            subsidy_intensity_B_region_l[["w_mean"]] + theme(legend.position = "none"),
            nrow = 1,
            label_x = 0,
            labels = c("A)", "B)")),
  
  get_legend(subsidy_intensity_B_grid_l[["w_mean"]]),


  ncol = 1,
  rel_heights = c(1, 0.2)

)

bottom_row <- plot_grid(
  F_Fmsy_region_l[["median"]],
  w_mean_B_subs_vs_F_Fmsy_l[["median"]] + theme(plot.margin = margin(1, 0, 1, 0, "cm")),
  nrow = 1,
  labels = c("C)", "D)")
)

Figure1 <- plot_grid(top_row,
                     bottom_row,
                     nrow = 2)

ggsave(paste0(results_dir, "Figure1.png"), dpi = 200, width = 14, height = 9.5)
```


